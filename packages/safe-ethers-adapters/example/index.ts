import { SafeEthersSigner, SafeService } from '../src/signer'
import dotenv from 'dotenv'
import { Wallet } from '@ethersproject/wallet'
import { JsonRpcProvider } from '@ethersproject/providers'

dotenv.config()

const sample = async () => {
    console.log("Setup provider")
    const provider = new JsonRpcProvider(process.env.JSON_RPC!!)
    console.log("Setup SafeServices")
    const service = new SafeService(process.env.SERVICE_URL!!)
    console.log("Setup Signer")
    const signer = new Wallet(process.env.SIGNER_KEY!!, provider)
    console.log("Setup SafeEthersSigner")
    const safe = await SafeEthersSigner.create(process.env.DEPLOYER_SAFE!!, signer, service, provider)
    const proposedTx = await safe.sendTransaction({
        value: 1,
        data: "0x60a06040523373ffffffffffffffffffffffffffffffffffffffff1660808173ffffffffffffffffffffffffffffffffffffffff1660601b8152505060805160601c61023b610058600039600060be015261023b6000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80635c36b1861461003b578063d5f394881461005a575b600080fd5b610043610078565b604051610051929190610143565b60405180910390f35b6100626100bc565b60405161006f9190610128565b60405180910390f35b60606000336040518060400160405280600481526020017f706f6e670000000000000000000000000000000000000000000000000000000081525090915091509091565b7f000000000000000000000000000000000000000000000000000000000000000081565b6100e98161018f565b82525050565b60006100fa82610173565b610104818561017e565b93506101148185602086016101c1565b61011d816101f4565b840191505092915050565b600060208201905061013d60008301846100e0565b92915050565b6000604082019050818103600083015261015d81856100ef565b905061016c60208301846100e0565b9392505050565b600081519050919050565b600082825260208201905092915050565b600061019a826101a1565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60005b838110156101df5780820151818401526020810190506101c4565b838111156101ee576000848401525b50505050565b6000601f19601f830116905091905056fea2646970667358221220ab587732cf954e3393f803868024ff72486d7a5922cf18ba6cc98ee1aee6989964736f6c63430008040033"
    })
    console.log("USER ACTION REQUIRED")
    console.log("Go to the Gnosis Safe Web App to confirm the transcation")
    console.log(await proposedTx.wait())
    console.log("Transaction has been executed")
}

sample()